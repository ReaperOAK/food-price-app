"use strict";(self.webpackChunkfood_price_app=self.webpackChunkfood_price_app||[]).push([[410],{410:(e,t,a)=>{a.r(t),a.d(t,{default:()=>u});var s=a(9950),n=a(9430),l=a(5500),i=a(2199),o=a(335),c=a(1204),d=a(7790),r=a(364),p=a(7136),h=a(4414);const u=e=>{let{setIsAuthenticated:t}=e;const a=(new Date).toISOString().split("T")[0],[u,y]=(0,s.useState)({date:a,rate:""}),[m,b]=(0,s.useState)([]),[f,S]=(0,s.useState)([]),[g,x]=(0,s.useState)([]),[j,v]=(0,s.useState)(!0),[C,N]=(0,s.useState)(null),[w,_]=(0,s.useState)({key:"city",direction:"ascending"}),[O,A]=(0,s.useState)([]),[T,k]=(0,s.useState)(null),[P,R]=(0,s.useState)(""),[D,J]=(0,s.useState)(""),[E,I]=(0,s.useState)(null),[F,M]=(0,s.useState)(""),[L,q]=(0,s.useState)(null),[z,B]=(0,s.useState)(null),[G,H]=(0,s.useState)(a),K=(0,s.useCallback)((()=>{v(!0),fetch("/php/api/rates/get_all_rates.php?date=".concat(G)).then((e=>e.json())).then((e=>{x(e),v(!1)})).catch((e=>{N(e),v(!1)}))}),[G]),Q=(0,s.useCallback)((()=>{fetch("/php/api/location/get_states_and_cities.php").then((e=>e.json())).then((e=>{const t=[],a=[];for(const s in e)a.push({value:s,label:s}),t.push({value:s,label:s,type:"state"}),e[s].forEach((e=>{t.push({value:"".concat(e,"-").concat(s),label:"".concat(e,", ").concat(s),type:"city"})}));S(t),A(a)})).catch((e=>{}))}),[]);(0,s.useEffect)((()=>{K()}),[K]),(0,s.useEffect)((()=>{Q()}),[Q]);const U=s.useMemo((()=>{let e=[...g];return e.sort(((e,t)=>e[w.key]<t[w.key]?"ascending"===w.direction?-1:1:e[w.key]>t[w.key]?"ascending"===w.direction?1:-1:0)),e}),[g,w]),V=()=>{y({date:a,rate:""}),b([]),k(null),M(""),q(null),B(null),R(""),J(""),I(null)};return j?(0,h.jsx)("div",{children:"Loading..."}):C?(0,h.jsxs)("div",{children:["Error loading data: ",C.message]}):(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(l.A,{setIsAuthenticated:t}),(0,h.jsx)("div",{className:"p-6 bg-gray-100 min-h-screen",children:(0,h.jsxs)("div",{className:"max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-md",children:[(0,h.jsx)("h1",{className:"text-3xl font-bold mb-6 text-center text-blue-600",children:"Admin Egg Rate Management"}),(0,h.jsxs)("div",{className:"mb-6",children:[(0,h.jsx)(i.A,{states:O,selectedState:T,handleStateChange:e=>{k(e),b([]);const t=f.filter((t=>"city"===t.type&&t.label.includes(e.value)));b(t)}}),(0,h.jsx)(o.A,{options:f,selectedOptions:m,setSelectedOptions:b}),(0,h.jsx)(c.A,{eggRate:u,setEggRate:y,handleSubmit:e=>{e.preventDefault();const t=m.map((e=>{const[t,a]="city"===e.type?e.label.split(", "):[null,e.value];return{city:t,state:a||"",date:u.date,rate:u.rate,type:e.type}}));fetch("/php/api/rates/update_multiple_rates.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.json())).then((e=>{K(),V()})).catch((e=>{}))},handleSelectAll:()=>{const e=f.filter((e=>"city"===e.type));b(e)},handleCopyPreviousRates:()=>{0!==m.length?(async()=>{const e=m.filter((e=>"city"===e.type)).map((e=>{const[t,a]=e.label.split(", ");return{city:t,state:a}})),t=await(async e=>{const t=await fetch("/php/api/rates/get_latest_rates.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await t.json()})(e),a=t.map((e=>({city:e.city,state:e.state,date:u.date,rate:e.rate||u.rate,type:"city"})));fetch("/php/api/rates/update_multiple_rates.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then((e=>e.json())).then((e=>{K(),V()})).catch((e=>{}))})():alert("Please select at least one city.")}}),(0,h.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-blue-600",children:"Add New State"}),(0,h.jsx)(d.A,{newState:P,setNewState:R,handleAddState:e=>{e.preventDefault(),fetch("/php/api/location/add_state_city.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"state",name:P})}).then((e=>e.json())).then((e=>{e.success?(Q(),R("")):alert(e.error)})).catch((e=>{}))}}),(0,h.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-blue-600",children:"Add New City"}),(0,h.jsx)(r.A,{states:O,newCity:D,setNewCity:J,newCityState:E,setNewCityState:I,handleAddCity:e=>{e.preventDefault(),fetch("/php/api/location/add_state_city.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"city",name:D,state:E.value})}).then((e=>e.json())).then((e=>{e.success?(Q(),J(""),I(null)):alert(e.error)})).catch((e=>{}))}}),(0,h.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-blue-600",children:"Remove State"}),(0,h.jsxs)("form",{onSubmit:e=>{e.preventDefault(),fetch("/php/api/location/remove_state_city.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"state",name:F})}).then((e=>e.json())).then((e=>{e.success?(Q(),M("")):alert(e.error)})).catch((e=>{}))},className:"mb-6 grid grid-cols-1 gap-4",children:[(0,h.jsx)(n.Ay,{options:O,value:O.find((e=>e.value===F)),onChange:e=>M(e.value),className:"w-full mb-4",placeholder:"Select State to Remove"}),(0,h.jsx)("button",{type:"submit",className:"bg-red-600 text-white p-3 rounded w-full hover:bg-red-700 transition",children:"Remove State"})]}),(0,h.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-blue-600",children:"Remove City"}),(0,h.jsxs)("form",{onSubmit:e=>{e.preventDefault(),fetch("/php/api/location/remove_state_city.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"city",name:L.label.split(", ")[0],state:z.value})}).then((e=>e.json())).then((e=>{e.success?(Q(),q(null),B(null)):alert(e.error)})).catch((e=>{}))},className:"mb-6 grid grid-cols-1 gap-4",children:[(0,h.jsx)(n.Ay,{options:O,value:O.find((e=>e.value===(null===z||void 0===z?void 0:z.value))),onChange:B,className:"w-full mb-4",placeholder:"Select State for City to Remove"}),(0,h.jsx)(n.Ay,{options:f.filter((e=>"city"===e.type&&e.label.includes(null===z||void 0===z?void 0:z.value))),value:L,onChange:q,className:"w-full mb-4",placeholder:"Select City to Remove"}),(0,h.jsx)("button",{type:"submit",className:"bg-red-600 text-white p-3 rounded w-full hover:bg-red-700 transition",children:"Remove City"})]}),(0,h.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-blue-600",children:"Current Egg Rates"}),(0,h.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"date",children:"Select Date"}),(0,h.jsx)("input",{type:"date",id:"date",value:G,onChange:e=>H(e.target.value),className:"border border-gray-300 p-3 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition"})]}),"          ",(0,h.jsx)(p.A,{rates:U,showAdmin:!0,showState:!0,showDate:!0,showChart:!1,showPriceColumns:!1,handleSort:e=>{let t="ascending";w.key===e&&"ascending"===w.direction&&(t="descending"),_({key:e,direction:t})},onEdit:e=>{const t=g.map((t=>t.id===e.id?e:t));x(t),fetch("/php/api/rates/update_rate.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json())).then((e=>{e.success&&K()})).catch((e=>{}))},onDelete:e=>{fetch("/php/api/rates/delete_rate.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id})}).then((e=>e.json())).then((e=>{K()})).catch((e=>{}))}})]})})]})}}}]);