"use strict";(self.webpackChunkfood_price_app=self.webpackChunkfood_price_app||[]).push([[410],{410:(e,t,a)=>{a.r(t),a.d(t,{default:()=>p});var s=a(9379),l=a(9950),n=a(9430),c=a(5500),r=a(2199),i=a(335),d=a(1204),o=a(7790),u=a(364),y=a(7136),m=a(5530),h=a(4414);const p=e=>{let{setIsAuthenticated:t}=e;const a=(new Date).toISOString().split("T")[0],[p,b]=(0,l.useState)({date:a,rate:""}),[v,x]=(0,l.useState)([]),[f,g]=(0,l.useState)([]),[S,w]=(0,l.useState)([]),[j,N]=(0,l.useState)(!0),[C,A]=(0,l.useState)(null),[F,k]=(0,l.useState)({key:"city",direction:"ascending"}),[D,R]=(0,l.useState)([]),[E,O]=(0,l.useState)(null),[I,_]=(0,l.useState)(""),[z,M]=(0,l.useState)(""),[P,T]=(0,l.useState)(null),[V,W]=(0,l.useState)(""),[G,L]=(0,l.useState)(null),[q,B]=(0,l.useState)(null),[H,J]=(0,l.useState)(a),K=(0,l.useCallback)((async()=>{try{N(!0);const e=await(0,m.VW)(H);w(e)}catch(C){A(C.message)}finally{N(!1)}}),[H]),Q=(0,l.useCallback)((async()=>{try{const e=await(0,m.bb)(),t=[],a=[];for(const s in e)t.push({value:s,label:s}),e[s].forEach((e=>{a.push({value:e,label:"".concat(e,", ").concat(s),type:"city"})}));R(t),g([...t.map((e=>(0,s.A)((0,s.A)({},e),{},{type:"state"}))),...a])}catch(C){}}),[]);(0,l.useEffect)((()=>{K()}),[K]),(0,l.useEffect)((()=>{Q()}),[Q]);const U=(0,l.useMemo)((()=>{if(!S)return[];const e=[...S];return e.sort(((e,t)=>"rate"===F.key?"ascending"===F.direction?e.rate-t.rate:t.rate-e.rate:"date"===F.key?"ascending"===F.direction?new Date(e.date)-new Date(t.date):new Date(t.date)-new Date(e.date):e[F.key]<t[F.key]?"ascending"===F.direction?-1:1:e[F.key]>t[F.key]?"ascending"===F.direction?1:-1:0)),e}),[S,F]);return j?(0,h.jsx)("div",{children:"Loading..."}):C?(0,h.jsxs)("div",{children:["Error loading data: ",C.message]}):(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(c.A,{setIsAuthenticated:t}),(0,h.jsx)("div",{className:"p-6 bg-gray-100 min-h-screen",children:(0,h.jsxs)("div",{className:"max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-md",children:[(0,h.jsx)("h1",{className:"text-3xl font-bold mb-6 text-center text-blue-600",children:"Admin Egg Rate Management"}),(0,h.jsxs)("div",{className:"mb-6",children:[(0,h.jsx)(r.A,{states:D,selectedState:E,handleStateChange:e=>{O(e),x((t=>t.filter((t=>"city"===t.type&&t.label.includes(null===e||void 0===e?void 0:e.value)))))}}),(0,h.jsx)(i.A,{options:f,selectedOptions:v,setSelectedOptions:x}),(0,h.jsx)(d.A,{eggRate:p,setEggRate:b,handleSubmit:async e=>{e.preventDefault();const t=v.map((e=>({city:"city"===e.type?e.value:e.label,state:"city"===e.type?e.label.split(", ")[1]:e.value,date:p.date,rate:parseFloat(p.rate)})));try{const e=await(0,m.xx)(t);e.success?(alert("Rates updated successfully"),K(),b({date:a,rate:""}),x([]),O(null),W(""),L(null),B(null),_(""),M(""),T(null)):alert(e.error||"Failed to update rates")}catch(C){alert("Failed to update rates")}},handleSelectAll:()=>{if(!E)return;const e=f.filter((e=>"city"===e.type&&e.label.includes(E.value)));x(e)},handleCopyPreviousRates:async()=>{try{const e=new Date(H);e.setDate(e.getDate()-1);const t=e.toISOString().split("T")[0],a=(await(0,m.VW)(t)).filter((e=>v.some((t=>"city"===t.type&&e.city===t.value||"state"===t.type&&e.state===t.value))));if(0===a.length)return void alert("No rates found for the previous day");b((e=>(0,s.A)((0,s.A)({},e),{},{rate:a[0].rate.toString()})))}catch(C){alert("Failed to fetch previous rates")}}}),(0,h.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-blue-600",children:"Add New State"}),(0,h.jsx)(o.A,{newState:I,setNewState:_,handleAddState:async e=>{e.preventDefault();try{const e=await(0,m.Nz)("state",I);e.success?(alert("State added successfully"),_(""),Q()):alert(e.error||"Failed to add state")}catch(C){alert("Failed to add state")}}}),(0,h.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-blue-600",children:"Add New City"}),(0,h.jsx)(u.A,{states:D,newCity:z,setNewCity:M,newCityState:P,setNewCityState:T,handleAddCity:async e=>{e.preventDefault();try{const e=await(0,m.Nz)("city",z,P.value);e.success?(alert("City added successfully"),M(""),T(null),Q()):alert(e.error||"Failed to add city")}catch(C){alert("Failed to add city")}}}),(0,h.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-blue-600",children:"Remove State"}),(0,h.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{const e=await(0,m.sl)("state",V);e.success?(alert("State removed successfully"),W(""),Q()):alert(e.error||"Failed to remove state")}catch(C){alert("Failed to remove state")}},className:"mb-6 grid grid-cols-1 gap-4",children:[(0,h.jsx)(n.Ay,{options:D,value:D.find((e=>e.value===V)),onChange:e=>W(e.value),className:"w-full mb-4",placeholder:"Select State to Remove"}),(0,h.jsx)("button",{type:"submit",className:"bg-red-600 text-white p-3 rounded w-full hover:bg-red-700 transition",children:"Remove State"})]}),(0,h.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-blue-600",children:"Remove City"}),(0,h.jsxs)("form",{onSubmit:async e=>{e.preventDefault();try{const e=G.label.split(", ")[0],t=await(0,m.sl)("city",e,q.value);t.success?(alert("City removed successfully"),L(null),B(null),Q()):alert(t.error||"Failed to remove city")}catch(C){alert("Failed to remove city")}},className:"mb-6 grid grid-cols-1 gap-4",children:[(0,h.jsx)(n.Ay,{options:D,value:D.find((e=>e.value===(null===q||void 0===q?void 0:q.value))),onChange:B,className:"w-full mb-4",placeholder:"Select State for City to Remove"}),(0,h.jsx)(n.Ay,{options:f.filter((e=>"city"===e.type&&e.label.includes(null===q||void 0===q?void 0:q.value))),value:G,onChange:L,className:"w-full mb-4",placeholder:"Select City to Remove"}),(0,h.jsx)("button",{type:"submit",className:"bg-red-600 text-white p-3 rounded w-full hover:bg-red-700 transition",children:"Remove City"})]}),(0,h.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-blue-600",children:"Current Egg Rates"}),(0,h.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"date",children:"Select Date"}),(0,h.jsx)("input",{type:"date",id:"date",value:H,onChange:e=>J(e.target.value),className:"border border-gray-300 p-3 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition"})]}),"          ",(0,h.jsx)(y.A,{rates:U,showAdmin:!0,showState:!0,showDate:!0,showChart:!1,showPriceColumns:!1,handleSort:e=>{let t="ascending";F.key===e&&"ascending"===F.direction&&(t="descending"),k({key:e,direction:t})},onEdit:async e=>{try{if((await(0,m.Gd)(e)).success){const t=S.map((t=>t.id===e.id?e:t));w(t),K()}else alert("Failed to update rate")}catch(C){alert("Failed to update rate")}},onDelete:async e=>{try{const t=await(0,m.iO)(e.id);t.success?(alert("Rate deleted successfully"),K()):alert(t.error||"Failed to delete rate")}catch(C){alert("Failed to delete rate")}}})]})})]})}}}]);