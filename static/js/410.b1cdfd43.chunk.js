"use strict";(self.webpackChunkfood_price_app=self.webpackChunkfood_price_app||[]).push([[410],{410:(e,t,a)=>{a.r(t),a.d(t,{default:()=>p});var s=a(9950),l=a(5500),c=a(9647),n=a(2519),i=a(1204),o=a(7790),d=a(364),r=a(7136),u=a(9430),h=a(5530),m=a(4414);const p=e=>{let{setIsAuthenticated:t}=e;const a=(new Date).toISOString().split("T")[0],[p,y]=(0,s.useState)({date:a,rate:""}),[x,b]=(0,s.useState)([]),[f,g]=(0,s.useState)([]),[v,S]=(0,s.useState)([]),[w,j]=(0,s.useState)(!0),[N,C]=(0,s.useState)(null),[k,A]=(0,s.useState)({key:"city",direction:"ascending"}),[F,R]=(0,s.useState)([]),[E,D]=(0,s.useState)(null),[O,_]=(0,s.useState)(""),[I,P]=(0,s.useState)(""),[z,M]=(0,s.useState)(null),[U,G]=(0,s.useState)(""),[L,T]=(0,s.useState)(null),[V,W]=(0,s.useState)(null),[Y,q]=(0,s.useState)(a),B=(0,s.useCallback)((()=>{j(!0),(0,h.VW)(Y).then((e=>{S(e),j(!1)})).catch((e=>{C(e.message),j(!1)}))}),[Y]),H=(0,s.useCallback)((()=>{(0,h.bb)().then((e=>{const t=Object.keys(e).filter((e=>"Unknown"!==e&&"special"!==e)).map((e=>({value:e,label:e})));R(t);const a=[];Object.entries(e).forEach((e=>{let[t,s]=e;"Unknown"!==t&&"special"!==t&&s.forEach((e=>{a.push({value:e,label:"".concat(e,", ").concat(t),type:"city",state:t})}))})),g(a)})).catch((e=>{}))}),[]);(0,s.useEffect)((()=>{B()}),[B]),(0,s.useEffect)((()=>{H()}),[H]);const J=(0,s.useMemo)((()=>{let e=[...v];return e.sort(((e,t)=>"rate"===k.key?"ascending"===k.direction?parseFloat(e.rate)-parseFloat(t.rate):parseFloat(t.rate)-parseFloat(e.rate):e[k.key]<t[k.key]?"ascending"===k.direction?-1:1:e[k.key]>t[k.key]?"ascending"===k.direction?1:-1:0)),e}),[v,k]),K=()=>{y({date:a,rate:""}),b([]),D(null),G(""),T(null),W(null),_(""),P(""),M(null)};return w?(0,m.jsx)("div",{children:"Loading..."}):N?(0,m.jsxs)("div",{children:["Error loading data: ",N.message]}):(0,m.jsxs)(m.Fragment,{children:[(0,m.jsx)(l.A,{setIsAuthenticated:t}),(0,m.jsx)("div",{className:"p-6 bg-gray-100 min-h-screen",children:(0,m.jsxs)("div",{className:"max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-md",children:[(0,m.jsx)("h1",{className:"text-3xl font-bold mb-6 text-center text-blue-600",children:"Admin Egg Rate Management"}),(0,m.jsxs)("div",{className:"mb-6",children:[(0,m.jsx)(c.A,{states:F,selectedState:E,handleStateChange:e=>{D(e),b([]);const t=f.filter((t=>"city"===t.type&&t.state===e.value));b(t)}}),(0,m.jsx)(n.A,{options:f,selectedOptions:x,setSelectedOptions:b}),(0,m.jsx)(i.A,{eggRate:p,setEggRate:y,handleSubmit:e=>{e.preventDefault();const t=x.map((e=>({city:e.value,state:e.state,rate:parseFloat(p.rate),date:p.date})));(0,h.xx)(t).then((e=>{e.success?(alert("Rates updated successfully!"),B(),K()):alert("Failed to update rates: "+e.message)})).catch((e=>{}))},handleSelectAll:()=>{const e=f.filter((e=>"city"===e.type&&(!E||e.state===E.value)));b(e)},handleCopyPreviousRates:async()=>{if(0!==x.length)try{const e=x.map((e=>({city:e.value,state:e.state}))),t=await(0,h.Y8)(null,null),s={};t.forEach((e=>{s["".concat(e.city,"-").concat(e.state)]=e.rate}));const l=e.map((e=>({city:e.city,state:e.state,rate:s["".concat(e.city,"-").concat(e.state)]||"",date:a}))).filter((e=>""!==e.rate));if(0===l.length)return void alert("No previous rates found for selected cities");await(0,h.xx)(l),alert("Rates copied successfully!"),B(),K()}catch(N){alert("Failed to copy previous rates")}else alert("Please select at least one city")}}),(0,m.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-blue-600",children:"Add New State"}),(0,m.jsx)(o.A,{newState:O,setNewState:_,handleAddState:e=>{e.preventDefault(),(0,h.Nz)("state",O).then((e=>{e.success?(alert("State added successfully!"),_(""),H()):alert("Failed to add state: "+e.message)})).catch((e=>{}))}}),(0,m.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-blue-600",children:"Add New City"}),(0,m.jsx)(d.A,{states:F,newCity:I,setNewCity:P,newCityState:z,setNewCityState:M,handleAddCity:e=>{e.preventDefault(),(0,h.Nz)("city",I,z.value).then((e=>{e.success?(alert("City added successfully!"),P(""),M(null),H()):alert("Failed to add city: "+e.message)})).catch((e=>{}))}}),(0,m.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-blue-600",children:"Remove State"}),(0,m.jsxs)("form",{onSubmit:e=>{e.preventDefault(),(0,h.sl)("state",U).then((e=>{e.success?(alert("State removed successfully!"),G(""),H()):alert("Failed to remove state: "+e.message)})).catch((e=>{}))},className:"mb-6 grid grid-cols-1 gap-4",children:[(0,m.jsx)(u.Ay,{options:F,value:F.find((e=>e.value===U)),onChange:e=>G(e.value),className:"w-full mb-4",placeholder:"Select State to Remove"}),(0,m.jsx)("button",{type:"submit",className:"bg-red-600 text-white p-3 rounded w-full hover:bg-red-700 transition",children:"Remove State"})]}),(0,m.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-blue-600",children:"Remove City"}),(0,m.jsxs)("form",{onSubmit:e=>{e.preventDefault();const t=L.label.split(", ")[0];(0,h.sl)("city",t,V.value).then((e=>{e.success?(alert("City removed successfully!"),T(null),W(null),H()):alert("Failed to remove city: "+e.message)})).catch((e=>{}))},className:"mb-6 grid grid-cols-1 gap-4",children:[(0,m.jsx)(u.Ay,{options:F,value:F.find((e=>e.value===(null===V||void 0===V?void 0:V.value))),onChange:W,className:"w-full mb-4",placeholder:"Select State for City to Remove"}),(0,m.jsx)(u.Ay,{options:f.filter((e=>"city"===e.type&&e.label.includes(null===V||void 0===V?void 0:V.value))),value:L,onChange:T,className:"w-full mb-4",placeholder:"Select City to Remove"}),(0,m.jsx)("button",{type:"submit",className:"bg-red-600 text-white p-3 rounded w-full hover:bg-red-700 transition",children:"Remove City"})]}),(0,m.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-blue-600",children:"Current Egg Rates"}),(0,m.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"date",children:"Select Date"}),(0,m.jsx)("input",{type:"date",id:"date",value:Y,onChange:e=>q(e.target.value),className:"border border-gray-300 p-3 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition"})]}),"          ",(0,m.jsx)(r.default,{rates:J,showAdmin:!0,showState:!0,showDate:!0,showChart:!1,showPriceColumns:!1,handleSort:e=>{let t="ascending";k.key===e&&"ascending"===k.direction&&(t="descending"),A({key:e,direction:t})},onEdit:e=>{const t=v.map((t=>t.id===e.id?e:t));S(t),(0,h.Gd)(e).then((e=>{e.success||(alert("Failed to update rate: "+e.message),B())})).catch((e=>{B()}))},onDelete:e=>{(0,h.iO)(e.id).then((e=>{e.success?(alert("Rate deleted successfully!"),B()):alert("Failed to delete rate: "+e.message)})).catch((e=>{}))}})]})})]})}}}]);