"use strict";(self.webpackChunkfood_price_app=self.webpackChunkfood_price_app||[]).push([[529],{9529:(e,t,a)=>{a.r(t),a.d(t,{default:()=>T});var o,r=a(3620),n=a(5043),s=a(2601),l=a(3216),i=a(5475);const d=e=>{let{setIsAuthenticated:t}=e;const a=(0,l.Zp)();return(0,r.A)("nav",{className:"bg-gray-800 p-4 shadow-lg"},void 0,(0,r.A)("div",{className:"container mx-auto flex justify-between items-center"},void 0,o||(o=(0,r.A)("div",{},void 0,(0,r.A)(i.N_,{to:"/admin",className:"text-white text-2xl font-bold"},void 0,"Admin Dashboard"))),(0,r.A)("div",{className:"flex space-x-4"},void 0,(0,r.A)("button",{onClick:()=>{t(!1),a("/login")},className:"text-white bg-red-600 hover:bg-red-700 px-4 py-2 rounded transition duration-150 ease-in-out"},void 0,"Logout"))))},c=e=>{let{states:t,selectedState:a,handleStateChange:o}=e;return(0,r.A)(s.Ay,{options:t,value:a,onChange:o,className:"w-full mb-4",placeholder:"Select State"})};var u=a(9379);const p=e=>{let{options:t,selectedOptions:a,setSelectedOptions:o}=e;const n=Array.from(new Set(t.map((e=>e.value)))).map((e=>t.find((t=>t.value===e))));return(0,r.A)(s.Ay,{isMulti:!0,options:n,value:a,onChange:o,className:"w-full",styles:{control:e=>(0,u.A)((0,u.A)({},e),{},{backgroundColor:"white",borderColor:"transparent",boxShadow:"none","&:hover":{borderColor:"transparent"},padding:"0.5rem",borderRadius:"0.375rem"}),menu:e=>(0,u.A)((0,u.A)({},e),{},{zIndex:9999}),placeholder:e=>(0,u.A)((0,u.A)({},e),{},{color:"#A0AEC0"})},placeholder:"Select Cities, States"})};var h;const g=e=>{let{eggRate:t,setEggRate:a,handleSubmit:o,handleSelectAll:n,handleCopyPreviousRates:s}=e;return(0,r.A)("form",{onSubmit:o,className:"mb-6 grid grid-cols-1 gap-4"},void 0,(0,r.A)("button",{type:"button",onClick:n,className:"bg-green-600 text-white p-3 rounded w-full hover:bg-green-700 transition"},void 0,"Select All Cities"),(0,r.A)("input",{type:"date",value:t.date,onChange:e=>a((0,u.A)((0,u.A)({},t),{},{date:e.target.value})),className:"border border-gray-300 p-3 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition",required:!0}),(0,r.A)("input",{type:"number",placeholder:"Rate",value:t.rate,onChange:e=>a((0,u.A)((0,u.A)({},t),{},{rate:e.target.value})),className:"border border-gray-300 p-3 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition",required:!0}),h||(h=(0,r.A)("button",{type:"submit",className:"bg-blue-600 text-white p-3 rounded w-full hover:bg-blue-700 transition"},void 0,"Update Rates")),(0,r.A)("button",{type:"button",onClick:s,className:"bg-yellow-600 text-white p-3 rounded w-full hover:bg-yellow-700 transition"},void 0,"Copy Previous Rates"))};var b;const m=e=>{let{newState:t,setNewState:a,handleAddState:o}=e;return(0,r.A)("form",{onSubmit:o,className:"mb-6 grid grid-cols-1 gap-4"},void 0,(0,r.A)("input",{type:"text",placeholder:"New State",value:t,onChange:e=>a(e.target.value),className:"border border-gray-300 p-3 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition",required:!0}),b||(b=(0,r.A)("button",{type:"submit",className:"bg-blue-600 text-white p-3 rounded w-full hover:bg-blue-700 transition"},void 0,"Add State")))};var y;const v=e=>{let{states:t,newCity:a,setNewCity:o,newCityState:n,setNewCityState:l,handleAddCity:i}=e;return(0,r.A)("form",{onSubmit:i,className:"mb-6 grid grid-cols-1 gap-4"},void 0,(0,r.A)(s.Ay,{options:t,value:n,onChange:l,className:"w-full mb-4",placeholder:"Select State for New City"}),(0,r.A)("input",{type:"text",placeholder:"New City",value:a,onChange:e=>o(e.target.value),className:"border border-gray-300 p-3 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition",required:!0}),y||(y=(0,r.A)("button",{type:"submit",className:"bg-blue-600 text-white p-3 rounded w-full hover:bg-blue-700 transition"},void 0,"Add City")))};var f,A=a(579);const S=e=>{var t;let{sortedEggRates:a,handleSort:o,setEggRate:s,handleDelete:l,handleEditRate:i}=e;const[d,c]=(0,n.useState)(null),[p,h]=(0,n.useState)({}),g=()=>{i(p),c(null)},b=()=>{c(null),h({})},m=e=>{const{name:t,value:a}=e.target;h((e=>(0,u.A)((0,u.A)({},e),{},{[t]:a})))};return(0,r.A)("div",{className:"overflow-x-auto"},void 0,(0,r.A)("table",{className:"min-w-full bg-white border border-gray-300"},void 0,(0,r.A)("thead",{},void 0,(0,r.A)("tr",{className:"bg-gray-200"},void 0,(0,r.A)("th",{className:"border border-gray-300 p-3 text-left cursor-pointer",onClick:()=>o("city")},void 0,"City"),(0,r.A)("th",{className:"border border-gray-300 p-3 text-left cursor-pointer",onClick:()=>o("state")},void 0,"State"),(0,r.A)("th",{className:"border border-gray-300 p-3 text-left cursor-pointer",onClick:()=>o("date")},void 0,"Date"),(0,r.A)("th",{className:"border border-gray-300 p-3 text-left cursor-pointer",onClick:()=>o("rate")},void 0,"Rate"),f||(f=(0,r.A)("th",{className:"border border-gray-300 p-3 text-left"},void 0,"Actions")))),(0,r.A)("tbody",{},void 0,a.map((e=>(0,r.A)("tr",{className:"hover:bg-gray-100"},"".concat(e.city,"-").concat(e.state,"-").concat(e.date),(0,r.A)("td",{className:"border border-gray-300 p-3"},void 0,e.city),(0,r.A)("td",{className:"border border-gray-300 p-3"},void 0,e.state),(0,r.A)("td",{className:"border border-gray-300 p-3"},void 0,d===e.id?(0,r.A)("input",{type:"date",name:"date",value:p.date,onChange:m,className:"border border-gray-300 p-2 rounded w-full"}):e.date),(0,r.A)("td",{className:"border border-gray-300 p-3"},void 0,d===e.id?(0,r.A)("input",{type:"number",name:"rate",value:p.rate,onChange:m,className:"border border-gray-300 p-2 rounded w-full"}):"$".concat(e.rate)),(0,r.A)("td",{className:"border border-gray-300 p-3 flex space-x-2"},void 0,d===e.id?t||(t=(0,A.jsxs)(A.Fragment,{children:[(0,r.A)("button",{onClick:g,className:"bg-green-500 text-white p-2 rounded hover:bg-green-600 transition"},void 0,"Save"),(0,r.A)("button",{onClick:b,className:"bg-gray-500 text-white p-2 rounded hover:bg-gray-600 transition"},void 0,"Cancel")]})):(0,A.jsxs)(A.Fragment,{children:[(0,r.A)("button",{onClick:()=>(e=>{c(e.id),h(e)})(e),className:"bg-yellow-500 text-white p-2 rounded hover:bg-yellow-600 transition"},void 0,"Edit"),(0,r.A)("button",{onClick:()=>l(e),className:"bg-red-500 text-white p-2 rounded hover:bg-red-600 transition"},void 0,"Delete")]}))))))))};var N,w,C,x,E,R,k,_,j,O;const T=e=>{let{setIsAuthenticated:t}=e;const a=(new Date).toISOString().split("T")[0],[o,l]=(0,n.useState)({date:a,rate:""}),[i,u]=(0,n.useState)([]),[h,b]=(0,n.useState)([]),[y,f]=(0,n.useState)([]),[T,P]=(0,n.useState)(!0),[D,J]=(0,n.useState)(null),[F,I]=(0,n.useState)({key:"city",direction:"ascending"}),[q,M]=(0,n.useState)([]),[L,z]=(0,n.useState)(null),[U,Z]=(0,n.useState)(""),[$,B]=(0,n.useState)(""),[G,H]=(0,n.useState)(null),[K,Q]=(0,n.useState)(""),[V,W]=(0,n.useState)(null),[X,Y]=(0,n.useState)(null),[ee,te]=(0,n.useState)(a),ae=(0,n.useCallback)((()=>{P(!0),fetch("/php/api/rates/get_all_rates.php?date=".concat(ee)).then((e=>e.json())).then((e=>{f(e),P(!1)})).catch((e=>{console.error("Error fetching rates:",e),J(e),P(!1)}))}),[ee]),oe=(0,n.useCallback)((()=>{fetch("/php/api/location/get_states_and_cities.php").then((e=>e.json())).then((e=>{const t=[],a=[];for(const o in e)a.push({value:o,label:o}),t.push({value:o,label:o,type:"state"}),e[o].forEach((e=>{t.push({value:"".concat(e,"-").concat(o),label:"".concat(e,", ").concat(o),type:"city"})}));b(t),M(a)})).catch((e=>console.error("Error fetching states and cities:",e)))}),[]);(0,n.useEffect)((()=>{ae()}),[ae]),(0,n.useEffect)((()=>{oe()}),[oe]);const re=n.useMemo((()=>{let e=[...y];return e.sort(((e,t)=>e[F.key]<t[F.key]?"ascending"===F.direction?-1:1:e[F.key]>t[F.key]?"ascending"===F.direction?1:-1:0)),e}),[y,F]),ne=()=>{l({date:a,rate:""}),u([]),z(null),Q(""),W(null),Y(null),Z(""),B(""),H(null)};return T?N||(N=(0,r.A)("div",{},void 0,"Loading...")):D?(0,r.A)("div",{},void 0,"Error loading data: ",D.message):(0,A.jsxs)(A.Fragment,{children:[(0,r.A)(d,{setIsAuthenticated:t}),(0,r.A)("div",{className:"p-6 bg-gray-100 min-h-screen"},void 0,(0,r.A)("div",{className:"max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-md"},void 0,w||(w=(0,r.A)("h1",{className:"text-3xl font-bold mb-6 text-center text-blue-600"},void 0,"Admin Egg Rate Management")),(0,r.A)("div",{className:"mb-6"},void 0,(0,r.A)(c,{states:q,selectedState:L,handleStateChange:e=>{z(e),u([]);const t=h.filter((t=>"city"===t.type&&t.label.includes(e.value)));u(t)}}),(0,r.A)(p,{options:h,selectedOptions:i,setSelectedOptions:u}),(0,r.A)(g,{eggRate:o,setEggRate:l,handleSubmit:e=>{e.preventDefault();const t=i.map((e=>{const[t,a]="city"===e.type?e.label.split(", "):[null,e.value];return{city:t,state:a||"",date:o.date,rate:o.rate,type:e.type}}));fetch("/php/api/rates/update_multiple_rates.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.json())).then((e=>{ae(),ne()})).catch((e=>console.error("Error submitting data:",e)))},handleSelectAll:()=>{const e=h.filter((e=>"city"===e.type));u(e)},handleCopyPreviousRates:()=>{if(0===i.length)return void alert("Please select at least one city.");(async()=>{const e=i.filter((e=>"city"===e.type)).map((e=>{const[t,a]=e.label.split(", ");return{city:t,state:a}}));console.log("Selected cities for updating rates:",e);const t=await(async e=>{console.log("Fetching latest rates for cities:",e);const t=await fetch("/php/api/rates/get_latest_rates.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await t.json();return console.log("Fetched latest rates:",a),a})(e),a=t.map((e=>({city:e.city,state:e.state,date:o.date,rate:e.rate||o.rate,type:"city"})));console.log("Payload for updating rates:",a),fetch("/php/api/rates/update_multiple_rates.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then((e=>e.json())).then((e=>{console.log("Response from updating rates:",e),ae(),ne()})).catch((e=>console.error("Error submitting data:",e)))})()}}),C||(C=(0,r.A)("h2",{className:"text-2xl font-semibold mb-4 text-blue-600"},void 0,"Add New State")),(0,r.A)(m,{newState:U,setNewState:Z,handleAddState:e=>{e.preventDefault(),fetch("/php/api/location/add_state_city.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"state",name:U})}).then((e=>e.json())).then((e=>{e.success?(oe(),Z("")):alert(e.error)})).catch((e=>console.error("Error adding state:",e)))}}),x||(x=(0,r.A)("h2",{className:"text-2xl font-semibold mb-4 text-blue-600"},void 0,"Add New City")),(0,r.A)(v,{states:q,newCity:$,setNewCity:B,newCityState:G,setNewCityState:H,handleAddCity:e=>{e.preventDefault(),fetch("/php/api/location/add_state_city.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"city",name:$,state:G.value})}).then((e=>e.json())).then((e=>{e.success?(oe(),B(""),H(null)):alert(e.error)})).catch((e=>console.error("Error adding city:",e)))}}),E||(E=(0,r.A)("h2",{className:"text-2xl font-semibold mb-4 text-blue-600"},void 0,"Remove State")),(0,r.A)("form",{onSubmit:e=>{e.preventDefault(),fetch("/php/api/location/remove_state_city.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"state",name:K})}).then((e=>e.json())).then((e=>{e.success?(oe(),Q("")):alert(e.error)})).catch((e=>console.error("Error removing state:",e)))},className:"mb-6 grid grid-cols-1 gap-4"},void 0,(0,r.A)(s.Ay,{options:q,value:q.find((e=>e.value===K)),onChange:e=>Q(e.value),className:"w-full mb-4",placeholder:"Select State to Remove"}),R||(R=(0,r.A)("button",{type:"submit",className:"bg-red-600 text-white p-3 rounded w-full hover:bg-red-700 transition"},void 0,"Remove State"))),k||(k=(0,r.A)("h2",{className:"text-2xl font-semibold mb-4 text-blue-600"},void 0,"Remove City")),(0,r.A)("form",{onSubmit:e=>{e.preventDefault(),fetch("/php/api/location/remove_state_city.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"city",name:V.label.split(", ")[0],state:X.value})}).then((e=>e.json())).then((e=>{e.success?(oe(),W(null),Y(null)):alert(e.error)})).catch((e=>console.error("Error removing city:",e)))},className:"mb-6 grid grid-cols-1 gap-4"},void 0,(0,r.A)(s.Ay,{options:q,value:q.find((e=>e.value===(null===X||void 0===X?void 0:X.value))),onChange:Y,className:"w-full mb-4",placeholder:"Select State for City to Remove"}),(0,r.A)(s.Ay,{options:h.filter((e=>"city"===e.type&&e.label.includes(null===X||void 0===X?void 0:X.value))),value:V,onChange:W,className:"w-full mb-4",placeholder:"Select City to Remove"}),_||(_=(0,r.A)("button",{type:"submit",className:"bg-red-600 text-white p-3 rounded w-full hover:bg-red-700 transition"},void 0,"Remove City"))),j||(j=(0,r.A)("h2",{className:"text-2xl font-semibold mb-4 text-blue-600"},void 0,"Current Egg Rates")),O||(O=(0,r.A)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"date"},void 0,"Select Date")),(0,r.A)("input",{type:"date",id:"date",value:ee,onChange:e=>te(e.target.value),className:"border border-gray-300 p-3 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition"})),(0,r.A)(S,{sortedEggRates:re,handleSort:e=>{let t="ascending";F.key===e&&"ascending"===F.direction&&(t="descending"),I({key:e,direction:t})},setEggRate:l,handleDelete:e=>{fetch("/php/api/rates/delete_rate.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id})}).then((e=>e.json())).then((e=>{ae()})).catch((e=>console.error("Error deleting item:",e)))},handleEditRate:e=>{const t=y.map((t=>t.id===e.id?e:t));f(t),fetch("/php/api/rates/update_rate.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json())).then((e=>{e.success?ae():console.error("Error updating rate:",e.error)})).catch((e=>console.error("Error updating rate:",e)))}})))]})}}}]);
//# sourceMappingURL=529.84bd5fb1.chunk.js.map