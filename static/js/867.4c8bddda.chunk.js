"use strict";(self.webpackChunkfood_price_app=self.webpackChunkfood_price_app||[]).push([[867],{6867:(e,t,a)=>{a.r(t),a.d(t,{default:()=>y});var n=a(9950),s=a(9430),l=a(8429),o=a(2074),i=a(4414);const r=e=>{let{setIsAuthenticated:t}=e;const a=(0,l.Zp)();return(0,i.jsx)("nav",{className:"bg-gray-800 p-4 shadow-lg",children:(0,i.jsxs)("div",{className:"container mx-auto px-4 w-full max-w-7xl flex justify-between items-center transition-none",children:[(0,i.jsx)("div",{children:(0,i.jsx)(o.N_,{to:"/admin",className:"text-white text-2xl font-bold",children:"Admin Dashboard"})}),(0,i.jsx)("div",{className:"flex space-x-4",children:(0,i.jsx)("button",{onClick:()=>{t(!1),a("/login")},className:"text-white bg-red-600 hover:bg-red-700 px-4 py-2 rounded transition duration-150 ease-in-out",children:"Logout"})})]})})},c=e=>{let{states:t,selectedState:a,handleStateChange:n}=e;return(0,i.jsx)(s.Ay,{options:t,value:a,onChange:n,className:"w-full mb-4",placeholder:"Select State"})};var d=a(9379);const u=e=>{let{options:t,selectedOptions:a,setSelectedOptions:n}=e;const l=Array.from(new Set(t.map((e=>e.value)))).map((e=>t.find((t=>t.value===e))));return(0,i.jsx)(s.Ay,{isMulti:!0,options:l,value:a,onChange:n,className:"w-full",styles:{control:e=>(0,d.A)((0,d.A)({},e),{},{backgroundColor:"white",borderColor:"transparent",boxShadow:"none","&:hover":{borderColor:"transparent"},padding:"0.5rem",borderRadius:"0.375rem"}),menu:e=>(0,d.A)((0,d.A)({},e),{},{zIndex:9999}),placeholder:e=>(0,d.A)((0,d.A)({},e),{},{color:"#A0AEC0"})},placeholder:"Select Cities, States"})},p=e=>{let{eggRate:t,setEggRate:a,handleSubmit:n,handleSelectAll:s,handleCopyPreviousRates:l}=e;return(0,i.jsxs)("form",{onSubmit:n,className:"mb-6 grid grid-cols-1 gap-4",children:[(0,i.jsx)("button",{type:"button",onClick:s,className:"bg-green-600 text-white p-3 rounded w-full hover:bg-green-700 transition",children:"Select All Cities"}),(0,i.jsx)("input",{type:"date",value:t.date,onChange:e=>a((0,d.A)((0,d.A)({},t),{},{date:e.target.value})),className:"border border-gray-300 p-3 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition",required:!0}),(0,i.jsx)("input",{type:"number",placeholder:"Rate",value:t.rate,onChange:e=>a((0,d.A)((0,d.A)({},t),{},{rate:e.target.value})),className:"border border-gray-300 p-3 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition",required:!0}),(0,i.jsx)("button",{type:"submit",className:"bg-blue-600 text-white p-3 rounded w-full hover:bg-blue-700 transition",children:"Update Rates"}),(0,i.jsx)("button",{type:"button",onClick:l,className:"bg-yellow-600 text-white p-3 rounded w-full hover:bg-yellow-700 transition",children:"Copy Previous Rates"})]})},h=e=>{let{newState:t,setNewState:a,handleAddState:n}=e;return(0,i.jsxs)("form",{onSubmit:n,className:"mb-6 grid grid-cols-1 gap-4",children:[(0,i.jsx)("input",{type:"text",placeholder:"New State",value:t,onChange:e=>a(e.target.value),className:"border border-gray-300 p-3 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition",required:!0}),(0,i.jsx)("button",{type:"submit",className:"bg-blue-600 text-white p-3 rounded w-full hover:bg-blue-700 transition",children:"Add State"})]})},m=e=>{let{states:t,newCity:a,setNewCity:n,newCityState:l,setNewCityState:o,handleAddCity:r}=e;return(0,i.jsxs)("form",{onSubmit:r,className:"mb-6 grid grid-cols-1 gap-4",children:[(0,i.jsx)(s.Ay,{options:t,value:l,onChange:o,className:"w-full mb-4",placeholder:"Select State for New City"}),(0,i.jsx)("input",{type:"text",placeholder:"New City",value:a,onChange:e=>n(e.target.value),className:"border border-gray-300 p-3 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition",required:!0}),(0,i.jsx)("button",{type:"submit",className:"bg-blue-600 text-white p-3 rounded w-full hover:bg-blue-700 transition",children:"Add City"})]})};var b=a(6277);const y=e=>{let{setIsAuthenticated:t}=e;const a=(new Date).toISOString().split("T")[0],[l,o]=(0,n.useState)({date:a,rate:""}),[d,y]=(0,n.useState)([]),[g,f]=(0,n.useState)([]),[x,S]=(0,n.useState)([]),[v,j]=(0,n.useState)(!0),[w,C]=(0,n.useState)(null),[N,A]=(0,n.useState)({key:"city",direction:"ascending"}),[_,O]=(0,n.useState)([]),[R,T]=(0,n.useState)(null),[k,P]=(0,n.useState)(""),[D,E]=(0,n.useState)(""),[J,I]=(0,n.useState)(null),[q,M]=(0,n.useState)(""),[F,L]=(0,n.useState)(null),[z,U]=(0,n.useState)(null),[Z,B]=(0,n.useState)(a),G=(0,n.useCallback)((()=>{j(!0),fetch("/php/api/rates/get_all_rates.php?date=".concat(Z)).then((e=>e.json())).then((e=>{S(e),j(!1)})).catch((e=>{C(e),j(!1)}))}),[Z]),H=(0,n.useCallback)((()=>{fetch("/php/api/location/get_states_and_cities.php").then((e=>e.json())).then((e=>{const t=[],a=[];for(const n in e)a.push({value:n,label:n}),t.push({value:n,label:n,type:"state"}),e[n].forEach((e=>{t.push({value:"".concat(e,"-").concat(n),label:"".concat(e,", ").concat(n),type:"city"})}));f(t),O(a)})).catch((e=>{}))}),[]);(0,n.useEffect)((()=>{G()}),[G]),(0,n.useEffect)((()=>{H()}),[H]);const K=n.useMemo((()=>{let e=[...x];return e.sort(((e,t)=>e[N.key]<t[N.key]?"ascending"===N.direction?-1:1:e[N.key]>t[N.key]?"ascending"===N.direction?1:-1:0)),e}),[x,N]),Q=()=>{o({date:a,rate:""}),y([]),T(null),M(""),L(null),U(null),P(""),E(""),I(null)};return v?(0,i.jsx)("div",{children:"Loading..."}):w?(0,i.jsxs)("div",{children:["Error loading data: ",w.message]}):(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r,{setIsAuthenticated:t}),(0,i.jsx)("div",{className:"p-6 bg-gray-100 min-h-screen",children:(0,i.jsxs)("div",{className:"max-w-4xl mx-auto bg-white p-8 rounded-lg shadow-md",children:[(0,i.jsx)("h1",{className:"text-3xl font-bold mb-6 text-center text-blue-600",children:"Admin Egg Rate Management"}),(0,i.jsxs)("div",{className:"mb-6",children:[(0,i.jsx)(c,{states:_,selectedState:R,handleStateChange:e=>{T(e),y([]);const t=g.filter((t=>"city"===t.type&&t.label.includes(e.value)));y(t)}}),(0,i.jsx)(u,{options:g,selectedOptions:d,setSelectedOptions:y}),(0,i.jsx)(p,{eggRate:l,setEggRate:o,handleSubmit:e=>{e.preventDefault();const t=d.map((e=>{const[t,a]="city"===e.type?e.label.split(", "):[null,e.value];return{city:t,state:a||"",date:l.date,rate:l.rate,type:e.type}}));fetch("/php/api/rates/update_multiple_rates.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>e.json())).then((e=>{G(),Q()})).catch((e=>{}))},handleSelectAll:()=>{const e=g.filter((e=>"city"===e.type));y(e)},handleCopyPreviousRates:()=>{0!==d.length?(async()=>{const e=d.filter((e=>"city"===e.type)).map((e=>{const[t,a]=e.label.split(", ");return{city:t,state:a}})),t=await(async e=>{const t=await fetch("/php/api/rates/get_latest_rates.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await t.json()})(e),a=t.map((e=>({city:e.city,state:e.state,date:l.date,rate:e.rate||l.rate,type:"city"})));fetch("/php/api/rates/update_multiple_rates.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).then((e=>e.json())).then((e=>{G(),Q()})).catch((e=>{}))})():alert("Please select at least one city.")}}),(0,i.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-blue-600",children:"Add New State"}),(0,i.jsx)(h,{newState:k,setNewState:P,handleAddState:e=>{e.preventDefault(),fetch("/php/api/location/add_state_city.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"state",name:k})}).then((e=>e.json())).then((e=>{e.success?(H(),P("")):alert(e.error)})).catch((e=>{}))}}),(0,i.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-blue-600",children:"Add New City"}),(0,i.jsx)(m,{states:_,newCity:D,setNewCity:E,newCityState:J,setNewCityState:I,handleAddCity:e=>{e.preventDefault(),fetch("/php/api/location/add_state_city.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"city",name:D,state:J.value})}).then((e=>e.json())).then((e=>{e.success?(H(),E(""),I(null)):alert(e.error)})).catch((e=>{}))}}),(0,i.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-blue-600",children:"Remove State"}),(0,i.jsxs)("form",{onSubmit:e=>{e.preventDefault(),fetch("/php/api/location/remove_state_city.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"state",name:q})}).then((e=>e.json())).then((e=>{e.success?(H(),M("")):alert(e.error)})).catch((e=>{}))},className:"mb-6 grid grid-cols-1 gap-4",children:[(0,i.jsx)(s.Ay,{options:_,value:_.find((e=>e.value===q)),onChange:e=>M(e.value),className:"w-full mb-4",placeholder:"Select State to Remove"}),(0,i.jsx)("button",{type:"submit",className:"bg-red-600 text-white p-3 rounded w-full hover:bg-red-700 transition",children:"Remove State"})]}),(0,i.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-blue-600",children:"Remove City"}),(0,i.jsxs)("form",{onSubmit:e=>{e.preventDefault(),fetch("/php/api/location/remove_state_city.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"city",name:F.label.split(", ")[0],state:z.value})}).then((e=>e.json())).then((e=>{e.success?(H(),L(null),U(null)):alert(e.error)})).catch((e=>{}))},className:"mb-6 grid grid-cols-1 gap-4",children:[(0,i.jsx)(s.Ay,{options:_,value:_.find((e=>e.value===(null===z||void 0===z?void 0:z.value))),onChange:U,className:"w-full mb-4",placeholder:"Select State for City to Remove"}),(0,i.jsx)(s.Ay,{options:g.filter((e=>"city"===e.type&&e.label.includes(null===z||void 0===z?void 0:z.value))),value:F,onChange:L,className:"w-full mb-4",placeholder:"Select City to Remove"}),(0,i.jsx)("button",{type:"submit",className:"bg-red-600 text-white p-3 rounded w-full hover:bg-red-700 transition",children:"Remove City"})]}),(0,i.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-blue-600",children:"Current Egg Rates"}),(0,i.jsx)("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"date",children:"Select Date"}),(0,i.jsx)("input",{type:"date",id:"date",value:Z,onChange:e=>B(e.target.value),className:"border border-gray-300 p-3 rounded w-full focus:outline-none focus:ring-2 focus:ring-blue-500 transition"})]}),"          ",(0,i.jsx)(b.A,{rates:K,showAdmin:!0,showState:!0,showDate:!0,showChart:!1,showPriceColumns:!1,handleSort:e=>{let t="ascending";N.key===e&&"ascending"===N.direction&&(t="descending"),A({key:e,direction:t})},onEdit:e=>{const t=x.map((t=>t.id===e.id?e:t));S(t),fetch("/php/api/rates/update_rate.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((e=>e.json())).then((e=>{e.success&&G()})).catch((e=>{}))},onDelete:e=>{fetch("/php/api/rates/delete_rate.php",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:e.id})}).then((e=>e.json())).then((e=>{G()})).catch((e=>{}))}})]})})]})}}}]);